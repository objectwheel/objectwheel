#include <fit.h>
#include <titlebar.h>

#include <QLabel>
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPushButton>
#include <QGraphicsDropShadowEffect>

const uchar TitleBar::m_SettingsIconData[] = {"\x89\x50\x4E\x47\x0D\x0A\x1A\x0A\x00\x00\x00\x0D"
											  "\x49\x48\x44\x52\x00\x00\x00\x40\x00\x00\x00\x40"
											  "\x08\x04\x00\x00\x00\x00\x60\xB9\x55\x00\x00\x00"
											  "\x04\x67\x41\x4D\x41\x00\x00\xB1\x8F\x0B\xFC\x61"
											  "\x05\x00\x00\x00\x20\x63\x48\x52\x4D\x00\x00\x7A"
											  "\x25\x00\x00\x80\x83\x00\x00\xF9\xFF\x00\x00\x80"
											  "\xE9\x00\x00\x75\x30\x00\x00\xEA\x60\x00\x00\x3A"
											  "\x98\x00\x00\x17\x6F\x92\x5F\xC5\x46\x00\x00\x00"
											  "\x02\x62\x4B\x47\x44\x00\xFF\x87\x8F\xCC\xBF\x00"
											  "\x00\x00\x09\x70\x48\x59\x73\x00\x00\x0B\x13\x00"
											  "\x00\x0B\x13\x01\x00\x9A\x9C\x18\x00\x00\x00\x07"
											  "\x74\x49\x4D\x45\x07\xE0\x0B\x05\x02\x0F\x02\xF0"
											  "\x8C\xD9\x8C\x00\x00\x05\x7D\x49\x44\x41\x54\x68"
											  "\xDE\xB5\x99\x4B\x68\x94\x57\x14\xC7\x7F\xF3\x48"
											  "\x8C\x89\x36\xA1\x20\x3E\x12\x87\x10\xAB\x68\x34"
											  "\x62\x11\x44\xF0\x41\x54\x48\x15\x6A\x2D\x68\xB4"
											  "\x0B\x45\xD0\x5A\x74\x21\x82\x0B\x17\xB5\x0B\xDD"
											  "\x54\x37\x06\x45\x2C\xD6\x76\xA1\x8B\x6E\x74\xE3"
											  "\xA2\x0A\xED\xAA\xD5\x45\x21\x18\x51\xC1\x4C\xA8"
											  "\x4D\x6A\x7D\x54\xF3\x70\x30\xD6\xC4\x31\xC9\xCC"
											  "\xBF\x8B\xEF\x9B\xC7\x37\x33\xDF\xE3\x0E\xC9\x7F"
											  "\x36\x33\xDF\x9C\x7B\xCE\xFF\x9E\x7B\xEE\xB9\xE7"
											  "\x9E\x0F\x8C\xB0\x05\xF9\x7C\xB6\x98\x29\x24\x64"
											  "\x26\x2E\x80\x26\xBE\x64\x96\xF5\xD5\xA1\x69\x90"
											  "\x1F\xE9\x33\x56\x69\x4A\x40\xE8\xB4\xDC\x70\x5A"
											  "\x45\xBC\xFC\x10\x36\x11\x7E\x06\x50\xC5\x4A\x57"
											  "\x81\x95\x54\xD9\x52\x53\x38\xFF\xF9\xEA\x75\xF5"
											  "\x40\xAF\xE6\x9B\xFA\xC0\xC8\x03\x00\x34\x31\xDB"
											  "\xF5\xBF\xD9\x34\x99\xAA\x33\x22\x90\x02\x68\xA6"
											  "\xC6\x55\xA0\x86\x66\x5B\x6A\x6A\x08\x44\x00\x96"
											  "\x7B\x8A\x2C\xB7\xA5\xA6\x82\x40\x12\xA0\x9A\x66"
											  "\x4F\xA1\x66\xAA\x6D\xC9\xF2\xF0\xD2\x4E\x27\x27"
											  "\x8A\x58\xDA\x89\xA6\x55\x09\x79\x21\xA1\x56\x4B"
											  "\xB2\x70\x6E\x27\x6C\x0D\x2F\xBD\xCC\x3B\x73\x5A"
											  "\x9A\x43\xF6\xF3\xB4\xF5\x24\xAC\xF5\xBA\x23\x3F"
											  "\xDC\xD1\x7A\x85\xAD\xF1\x16\x0E\x65\xC6\x67\x3F"
											  "\x2E\x18\x40\x28\xA2\x5D\x3A\xA3\xED\x9A\x97\xA3"
											  "\x61\x7F\x5B\xAA\x0B\x1A\xF4\x35\x2F\x49\x83\xBA"
											  "\xA0\xA5\x05\xA3\xD1\x3C\x6D\xD7\x19\xED\x52\x44"
											  "\x0C\x78\xCC\x7F\xA3\x12\x92\xC6\x14\xD7\x45\x6D"
											  "\xD3\x5C\x7B\xF0\x1C\x1D\xD7\xE3\x40\xC6\x33\x78"
											  "\xAC\xE3\x9A\x63\x8F\x9E\xAB\x6D\xBA\xA8\xB8\xC6"
											  "\x24\x25\xB4\xD1\xE9\x83\x6C\xE2\x4E\x11\x86\x0F"
											  "\xB8\xCA\x27\xD9\xFF\xC6\x78\xC4\x6D\xFE\xA4\x96"
											  "\x4F\x3D\xB2\x9F\x3B\xBA\xF8\x99\x61\x16\xB1\x8E"
											  "\x85\x54\x66\x9F\xFE\xC2\x4E\xDE\xA4\x0B\xF7\x4A"
											  "\xAD\xC5\xF5\xA0\xC6\x8D\xE6\x59\x0E\xC6\x75\x50"
											  "\x88\xDA\x12\xEE\x5F\xA0\xB8\xA1\xB2\x09\x8D\x69"
											  "\x4C\x69\xC3\x51\x71\x2D\xC8\x2D\x43\x14\xEC\xE3"
											  "\x23\xCC\x61\x16\x07\x74\xEE\x7F\xF4\x70\x97\x38"
											  "\x2F\x18\x21\x4C\x1D\x8D\xB4\xF0\x31\x8D\x96\x36"
											  "\x5F\x2C\xE6\x30\x47\x49\x3F\xA3\xC1\x31\xFF\x56"
											  "\xBD\x0A\xC4\xFF\xB9\xCE\xAB\x55\x75\x05\x85\x48"
											  "\x54\x31\xED\xD6\x4D\x8D\x06\xD2\xF1\xCA\xCA\x16"
											  "\xD9\xF0\x13\x9A\xA9\x1B\x01\x06\xBE\xD3\x65\xAD"
											  "\x50\xC8\x32\x9A\xE2\x36\x00\xC3\xDC\xCB\xD0\xA8"
											  "\x51\xBB\x3A\x03\x51\xB8\xA1\x99\xCA\x9C\x1A\x42"
											  "\xE8\x40\x80\xF0\x7B\xAE\xFD\x9A\x66\xED\xEE\x8D"
											  "\x45\x7E\x7D\x9D\x21\xD1\xA0\x4B\x01\x74\x8D\xEB"
											  "\x40\xD6\x07\x42\x8D\x7A\xE8\x3B\xE4\x2F\xB5\x59"
											  "\x26\xBE\x76\x5D\xDC\x31\x8B\xC2\x74\x9D\x54\xD2"
											  "\x57\xDF\x43\x35\xE6\x08\xEC\x50\xCA\x77\xF6\x6D"
											  "\xF9\xE9\xD5\x0D\x6D\x16\x85\x4A\x9D\xF2\xD5\x98"
											  "\xD2\x8E\x1C\x81\xB5\x3E\x47\xCC\x3B\xED\xB7\x56"
											  "\x3D\x08\x64\xC5\xD4\x55\x1F\x02\x09\xAD\xCD\x11"
											  "\x88\x68\x9F\x06\x3C\x84\x2F\x6B\x9A\xFF\xEC\x33"
											  "\xA8\xB4\x28\x2C\xF3\x28\xDD\xA4\x01\xED\x53\x44"
											  "\x79\x8C\xD1\x56\xF5\xB9\xBA\x7F\x85\x59\xA5\x77"
											  "\xDD\xD2\x78\xCC\xD5\x7C\x9F\xB6\x3A\xCE\x45\xFB"
											  "\xCC\x5A\xA3\x7B\x25\xC5\xCF\x2B\x24\x8E\x1B\x10"
											  "\xB0\x35\xC6\xD4\x53\x52\xDF\x3D\xAD\x29\x8A\xA7"
											  "\x54\xC6\x6D\xB7\x8A\xC4\xDF\xA8\x35\xB8\xFB\x0B"
											  "\x22\xA1\xA3\x84\xF9\x5B\x5A\x56\x32\x9E\xEC\x85"
											  "\x58\x58\x54\x72\x74\xAA\x4E\x6C\x32\x26\x90\x46"
											  "\x68\xB3\xDE\x15\x68\xBB\xA3\x85\x2E\x45\x49\x67"
											  "\x86\xC2\x1E\x4D\x38\x86\x5C\x34\xBF\xED\x00\x2C"
											  "\xB1\x16\xC1\x19\x88\x13\xDA\x63\x59\xE9\xCC\xCA"
											  "\x65\x0B\xB7\x55\x84\x78\x0F\xD0\xCD\x5B\x87\xA6"
											  "\xB8\x69\xA1\x9D\x1D\x06\x43\x3C\x71\x3C\x7C\x4B"
											  "\x1C\xDE\x13\x62\x55\x31\x01\x80\xAA\xCC\x5A\xE4"
											  "\x90\xE2\x05\xFC\x51\x06\x01\x00\x92\xF4\x3B\x7E"
											  "\x8B\xB4\x6D\xA5\x34\x81\x12\x48\x33\x02\xEB\xCA"
											  "\x25\x90\x66\xC4\x4F\xC4\xFF\x5E\x60\x7E\x79\xCB"
											  "\x87\xEF\x2D\xC5\x4F\x7D\x94\x3A\x18\x2E\xD7\x7C"
											  "\xB4\xB0\xF2\xF2\x21\x90\x04\x08\x39\x3A\x0C\x21"
											  "\x1A\xE1\xA7\x72\x09\xD4\x50\xEF\xF8\x1D\x22\x8C"
											  "\x15\xEA\xC5\x04\x3A\x11\xD3\x00\x9A\x99\xE1\x90"
											  "\x68\x21\x7A\x08\x73\x3C\x05\x68\x20\xE6\x78\x38"
											  "\x83\x66\xA8\x40\xDC\x2F\x1E\xE0\x9A\x88\x1E\x29"
											  "\x26\x5E\x1B\x13\x48\x23\xB4\xB7\xE8\x50\xEE\xD2"
											  "\xA2\x92\x89\xC8\x23\x15\x8F\x6B\xB7\x79\x2A\x3A"
											  "\x8B\x50\x85\xAE\x95\x48\xC5\xB7\x4B\xA4\x62\x9F"
											  "\xC3\xE8\xA6\x6A\xC4\x98\x11\x01\x21\xB4\x5A\x43"
											  "\x25\xF5\xDD\x2F\x38\x8C\x7C\x8F\xE3\x51\xB5\x0B"
											  "\xD1\x16\xD8\x7C\xCA\x9A\xFF\x15\xB9\xA1\x4F\x9F"
											  "\xE5\x2D\x44\x80\x82\xA4\x53\x0D\xC1\x97\xC1\x2E"
											  "\x4F\xDB\xF5\xD6\x43\x63\x41\x41\xE2\x57\x92\x49"
											  "\x97\x34\x5D\x28\xEF\x8A\xE7\x63\xBE\x45\xDD\x3E"
											  "\x1A\x13\x5A\x67\x52\x94\x8E\xEB\xA4\x2A\x85\xB8"
											  "\xEE\xEF\x7C\xD4\xA4\xDF\xE4\x87\x94\xDA\xCD\xCA"
											  "\xF2\xA4\x4E\x69\xA6\x57\x65\x7C\x36\x13\x4D\x2D"
											  "\x01\xCC\x17\x94\xE5\xC1\x2E\x26\x29\x5D\xB5\xB6"
											  "\x90\x48\xB3\xC4\x61\xFC\x69\xC6\x78\x85\xDA\x7D"
											  "\x9D\x6F\x79\xF4\xAB\x6C\x54\x19\x5C\xCD\xA4\x5E"
											  "\x1D\x53\xCC\xA5\x51\x5D\xA1\xD5\xBA\xE2\x19\x7A"
											  "\x39\xDC\xD4\x07\x79\xB9\xC0\xE8\x72\x2A\xF5\xA8"
											  "\x43\x9B\x15\x53\xB5\xD5\x0B\x52\x54\xB5\x5A\xAA"
											  "\xBD\xBA\xE6\xB2\xEF\x8B\x91\xD0\x86\xCC\xFC\x43"
											  "\x00\xCF\xA8\x87\x30\x1D\x1C\x09\xBC\xD5\x93\xFC"
											  "\xCB\x13\xFA\x19\x21\x42\x2D\xF5\xC4\x98\x65\x70"
											  "\x70\x9F\xE3\x28\xE9\x17\xCC\xCB\x3D\x29\xB3\x41"
											  "\x51\x1E\x7A\xF2\x1B\x14\x36\xEB\x3A\x80\x5E\xCE"
											  "\x31\x11\x78\x16\xE5\x22\xC5\x39\x7A\xE1\x43\xFB"
											  "\xE7\xD4\x36\xA9\x6E\xD8\x4D\xAA\x8F\xF2\x32\xD8"
											  "\xAF\xEC\x64\x38\x5D\xAA\x54\x9A\xD4\x36\xDD\x3F"
											  "\xFA\x26\x3B\x7A\xAE\x3E\xD7\xF7\xEA\xB1\xDB\x74"
											  "\x9B\x5C\x93\xFA\xA4\x35\x2A\x87\xF4\x5D\x2E\x5F"
											  "\x64\x37\x69\xBD\xB6\xAB\x43\x5F\x28\x22\x06\xDD"
											  "\x7C\x36\x29\xAD\xDA\xAE\xC2\x56\xED\x91\xA0\xAD"
											  "\x5A\x98\x94\x66\xF5\x86\xD2\xCD\xEA\x6F\x6D\x0D"
											  "\xFD\x94\x8D\x24\x42\xD5\xFA\xDD\x93\xC0\x2D\xD5"
											  "\xA8\xA0\xEC\xF4\x86\x41\xD5\x5F\x05\x30\x4A\xB7"
											  "\xA7\x50\x37\x23\x58\xC5\xED\xE4\x13\xB0\xEF\x88"
											  "\x0F\x3C\x45\x1E\x4C\xFD\x2B\x9B\x6E\x8F\xEB\xD6"
											  "\x28\x0F\xA7\xF0\x95\x8D\x8D\x3E\x8F\x38\xEA\xE7"
											  "\x6F\x53\x75\x46\x04\x9E\x03\x0C\xD2\xE7\x2A\xD0"
											  "\xCB\x00\x86\x71\x6E\x44\xA0\x01\x20\x49\x97\xAB"
											  "\xC0\x5D\x92\x30\xC7\x88\x40\xB0\xFE\x76\x16\x13"
											  "\x44\xE1\x12\xE9\x92\x2F\xAF\x87\xF8\xC1\xBC\x99"
											  "\x51\xCE\xDB\xF3\x49\x55\xF9\x3F\xCA\xD0\x35\xCA"
											  "\x53\xDD\xAC\xBD\x00\x00\x00\x25\x74\x45\x58\x74"
											  "\x64\x61\x74\x65\x3A\x63\x72\x65\x61\x74\x65\x00"
											  "\x32\x30\x31\x36\x2D\x31\x31\x2D\x30\x35\x54\x30"
											  "\x32\x3A\x31\x35\x3A\x34\x31\x2B\x30\x33\x3A\x30"
											  "\x30\xB7\x27\x68\x28\x00\x00\x00\x25\x74\x45\x58"
											  "\x74\x64\x61\x74\x65\x3A\x6D\x6F\x64\x69\x66\x79"
											  "\x00\x32\x30\x31\x36\x2D\x31\x31\x2D\x30\x35\x54"
											  "\x30\x32\x3A\x31\x35\x3A\x30\x32\x2B\x30\x33\x3A"
											  "\x30\x30\x73\xD8\xC4\xF3\x00\x00\x00\x00\x49\x45"
											  "\x4E\x44\xAE\x42\x60\x82"};

const uchar TitleBar::m_MenuIconData[] = { "\x89\x50\x4E\x47\x0D\x0A\x1A\x0A\x00\x00\x00\x0D"
										   "\x49\x48\x44\x52\x00\x00\x00\x40\x00\x00\x00\x40"
										   "\x08\x04\x00\x00\x00\x00\x60\xB9\x55\x00\x00\x00"
										   "\x04\x67\x41\x4D\x41\x00\x00\xB1\x8F\x0B\xFC\x61"
										   "\x05\x00\x00\x00\x20\x63\x48\x52\x4D\x00\x00\x7A"
										   "\x25\x00\x00\x80\x83\x00\x00\xF9\xFF\x00\x00\x80"
										   "\xE9\x00\x00\x75\x30\x00\x00\xEA\x60\x00\x00\x3A"
										   "\x98\x00\x00\x17\x6F\x92\x5F\xC5\x46\x00\x00\x00"
										   "\x02\x62\x4B\x47\x44\x00\xFF\x87\x8F\xCC\xBF\x00"
										   "\x00\x00\x09\x70\x48\x59\x73\x00\x00\x0B\x13\x00"
										   "\x00\x0B\x13\x01\x00\x9A\x9C\x18\x00\x00\x00\x07"
										   "\x74\x49\x4D\x45\x07\xE0\x0B\x05\x02\x33\x39\x32"
										   "\x74\x49\x57\x00\x00\x01\x36\x49\x44\x41\x54\x68"
										   "\xDE\xED\x96\xAD\x4E\xC3\x60\x14\x86\x9F\x0E\xB6"
										   "\x6C\x30\x39\x50\x04\x43\xB8\x00\x10\x98\xC1\x0C"
										   "\x0A\x85\x83\x1B\x40\xC1\x35\x30\xCD\x0D\x60\xB1"
										   "\xBB\x02\x90\x78\x90\x24\xB0\x90\xE0\x48\x10\xCC"
										   "\x20\x1A\x4C\xDB\x1D\x44\x43\xF7\xB1\x2C\x23\x90"
										   "\x1C\x4A\xE0\x7D\x6A\x4E\xD3\xA4\xEF\xFB\x7D\xFD"
										   "\xC9\x03\x42\x08\x21\x02\xE6\x18\x62\xCE\xC7\x90"
										   "\xDD\x0F\x99\xD1\x68\x7C\x66\x21\x1F\x9A\xCC\x3A"
										   "\xAD\x30\x23\xC6\x20\xA1\x36\xA9\x80\x01\x2C\x71"
										   "\x48\x87\x86\x53\x81\x84\x6B\x4E\xB9\x87\x55\x1E"
										   "\xC6\xAF\xBD\x62\xD8\xA2\x5D\x98\x37\x57\xB6\x62"
										   "\x64\x45\x6E\xE5\x7D\x68\x00\xEC\xB1\xE3\xB4\xF6"
										   "\x11\x1B\x1C\x04\xB1\xC1\x04\x15\xB6\xDC\xE3\x01"
										   "\xDA\xCC\x87\xA1\xE1\x5C\xFB\xF2\xCD\xBE\x43\x35"
										   "\x4C\x0D\x0B\xA4\xDC\xFC\x48\x81\x5B\xE2\x09\x05"
										   "\x52\x80\x1E\x77\xEE\xF1\x4F\x9C\x61\x56\x9C\x16"
										   "\x9F\x61\x8B\x01\x40\x9B\x63\xD6\xA9\x3A\x85\x67"
										   "\xF4\x39\xE1\x1C\x2E\xD9\x1E\x2F\x00\x59\xBE\x1D"
										   "\x4D\x96\xA9\x3B\x15\x48\x78\xE4\x05\x2C\x78\xF2"
										   "\x51\x78\x3D\x0E\x5F\x4F\x37\x52\xB7\x0D\x16\x7F"
										   "\x00\xF9\x00\xF2\x01\xF9\x80\x7C\xA0\x47\xDF\x3D"
										   "\xFE\x53\x1F\xE8\xB2\x26\x1F\xF0\x45\x3E\x20\xA6"
										   "\x50\xB2\x0F\x0C\x68\xE5\x43\xC9\x3E\x70\x44\xC7"
										   "\xF1\x3F\xF0\xDB\x7D\x60\xBF\x5C\x1F\x98\x61\xD3"
										   "\x3D\x1E\xA6\xF8\x40\x24\x1F\x90\x0F\xC8\x07\x84"
										   "\x10\xE2\x5F\xF2\x06\xF7\x24\x3C\xCA\x88\x9A\xAD"
										   "\x97\x00\x00\x00\x25\x74\x45\x58\x74\x64\x61\x74"
										   "\x65\x3A\x63\x72\x65\x61\x74\x65\x00\x32\x30\x31"
										   "\x36\x2D\x31\x31\x2D\x30\x35\x54\x30\x32\x3A\x35"
										   "\x31\x3A\x35\x37\x2B\x30\x33\x3A\x30\x30\xA1\x6F"
										   "\x8E\x74\x00\x00\x00\x25\x74\x45\x58\x74\x64\x61"
										   "\x74\x65\x3A\x6D\x6F\x64\x69\x66\x79\x00\x32\x30"
										   "\x31\x36\x2D\x31\x31\x2D\x30\x35\x54\x30\x32\x3A"
										   "\x35\x31\x3A\x35\x37\x2B\x30\x33\x3A\x30\x30\xD0"
										   "\x32\x36\xC8\x00\x00\x00\x00\x49\x45\x4E\x44\xAE"
										   "\x42\x60\x82"};

TitleBar::TitleBar(QWidget *parent)
	: QWidget(parent)
	, m_Layout(new QVBoxLayout(this))
	, m_UpperLayout(new QHBoxLayout)
	, m_Title(new QLabel)
	, m_Menu(new QPushButton)
	, m_Settings(new QPushButton)
	, m_Color(QColor("#47a3da"))
	, m_ShadowBackground(new QWidget(this))
	, m_Shadow(new QWidget(m_ShadowBackground))
{
	connect(m_Menu, SIGNAL(toggled(bool)), this, SIGNAL(MenuToggled(bool)));
	connect(m_Settings, SIGNAL(toggled(bool)), this, SIGNAL(SettingsToggled(bool)));

	setAutoFillBackground(true);
	QPalette p(palette());
	p.setColor(QPalette::Window, m_Color);
	setPalette(p);

	m_UpperLayout->setContentsMargins(fit(10), 0, fit(10), 0);

	m_Title->setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Expanding);
	m_Menu->setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);
	m_Settings->setSizePolicy(QSizePolicy::Fixed, QSizePolicy::Fixed);

	QPixmap settings;
	settings.loadFromData(m_SettingsIconData, sizeof(m_SettingsIconData));
	m_Settings->setIcon(QIcon(settings));
	m_Settings->setIconSize(fit({24, 24}));
	m_Settings->setMinimumSize(fit ({32, 32}));
	m_Settings->setMaximumSize(fit ({32, 32}));
	m_Settings->setStyleSheet(QString("QPushButton {border:0px; border-radius: %1px;} QPushButton::checked {background:rgba(0,0,0,40);} QPushButton::pressed {background:rgba(0,0,0,40);}").arg(fit(15)));
	m_Settings->setCheckable(true);

	QPixmap menu;
	menu.loadFromData(m_MenuIconData, sizeof(m_MenuIconData));
	m_Menu->setIcon(QIcon(menu));
	m_Menu->setIconSize(fit({24, 24}));
	m_Menu->setMinimumSize(fit ({32, 32}));
	m_Menu->setMaximumSize(fit ({32, 32}));
	m_Menu->setStyleSheet(QString("QPushButton {border:0px; border-radius: %1px;} QPushButton::checked {background:rgba(0,0,0,40);} QPushButton::pressed {background:rgba(0,0,0,40);}").arg(fit(15)));
	m_Menu->setCheckable(true);

	m_Title->setAlignment(Qt::AlignCenter);
	m_Title->setStyleSheet("background:transparent; color:white;");

	m_UpperLayout->addWidget(m_Menu);
	m_UpperLayout->addWidget(m_Title);
	m_UpperLayout->addWidget(m_Settings);

	QVBoxLayout* layout = new QVBoxLayout(m_ShadowBackground);
	layout->setSpacing(0);
	layout->setContentsMargins(0, 0, 0, 0);
	layout->addWidget(m_Shadow);

	QPalette p2(m_ShadowBackground->palette());
	p2.setColor(QPalette::Window, Qt::white);
	m_ShadowBackground->setAutoFillBackground(true);
	m_ShadowBackground->setPalette(p2);
	m_ShadowBackground->setSizePolicy(QSizePolicy::Expanding, QSizePolicy::Fixed);
	m_ShadowBackground->setMinimumHeight(fit(5));
	m_ShadowBackground->setMaximumHeight(fit(5));
	m_Shadow->setStyleSheet("background:qlineargradient(spread:pad, x1:0.5, y1:0, x2:0.5, y2:1,stop:0 "
							"rgba(0, 0, 0, 100), stop:0.6 rgba(0, 0, 0, 20), stop:1 rgba(0, 0, 0, 0));");

	m_Layout->setSpacing(0);
	m_Layout->setContentsMargins(0, 0, 0, 0);
	m_Layout->addLayout(m_UpperLayout);
	m_Layout->addWidget(m_ShadowBackground);
}

const QColor& TitleBar::Color() const
{
	return m_Color;
}

void TitleBar::setColor(const QColor& Color)
{
	m_Color = Color;
	QPalette p(palette());
	p.setColor(QPalette::Window, m_Color);
	setPalette(p);
}

const QString& TitleBar::Text() const
{
	return m_Text;
}

void TitleBar::setText(const QString& Text)
{
	m_Text = Text;
	m_Title->setText(m_Text);
}

void TitleBar::hideButtons()
{
	m_Menu->hide();
	m_Settings->hide();
}

void TitleBar::showButtons()
{
	m_Menu->show();
	m_Settings->show();
}

void TitleBar::setMenuChecked(bool checked)
{
	emit m_Menu->setChecked(checked);
}

void TitleBar::setSettingsChecked(bool checked)
{
	emit m_Settings->setChecked(checked);
}

const QColor& TitleBar::ShadowColor() const
{
	return m_ShadowColor;
}

void TitleBar::setShadowColor(const QColor& ShadowColor)
{
	m_ShadowColor = ShadowColor;
	QPalette p(m_ShadowBackground->palette());
	p.setColor(QPalette::Window, m_ShadowColor);
	m_ShadowBackground->setPalette(p);
}
